# Feature 2.6: Track Selection and Highlighting

**Status**: Not Started
**Dependencies**: Feature 2 Phase 1 (Sidebar + Track List)
**Estimated Time**: 2-3 days
**Priority**: Medium

---

## Goal

Add track selection functionality: clicking a track in the sidebar selects it and highlights it on the map with a brighter, thicker line.

---

## Context

**Already Implemented:**
- Track list sidebar with visibility toggles
- All tracks render on map
- Eye icon toggles work instantly

**You're Adding:**
- Single-click selection on track list items
- Selected track highlighted in sidebar
- Selected track highlighted on map (brighter + thicker)
- Clicking map background deselects (optional)

---

## Acceptance Criteria

- [ ] Clicking track in sidebar selects it (highlights row in list)
- [ ] Only one track selected at a time (single select, not multi)
- [ ] Selected track highlighted on map: #FF66FF (brighter magenta) + 5px width
- [ ] Unselected tracks: #FF00FF (normal magenta) + 3px width
- [ ] Selection state persists during visibility toggles
- [ ] Selection cleared on new upload (optional)
- [ ] Clicking selected track again deselects it

---

## Implementation Sequence

### Step 1: Create Selection State Management

**Create `frontend/src/hooks/useSelection.ts`:**
```typescript
import { useState } from 'react';

export function useSelection() {
  const [selectedTrackId, setSelectedTrackId] = useState<number | null>(null);

  const toggleSelection = (trackId: number) => {
    setSelectedTrackId(prev => prev === trackId ? null : trackId);
  };

  const clearSelection = () => setSelectedTrackId(null);

  return { selectedTrackId, toggleSelection, clearSelection };
}
```

---

### Step 2: Update TrackListItem for Selection

**Modify `TrackListItem.tsx`:**
```typescript
interface TrackListItemProps {
  track: Track;
  isSelected: boolean;
  onSelect: () => void;
  onToggleVisibility: () => void;
}

export function TrackListItem({ track, isSelected, onSelect, onToggleVisibility }) {
  return (
    <div
      className={`track-item ${isSelected ? 'selected' : ''}`}
      onClick={onSelect}
    >
      {/* rest of component */}
    </div>
  );
}
```

**Add CSS:**
```css
.track-item.selected {
  background: var(--color-bg);
  border-left: 3px solid var(--color-primary);
  padding-left: 13px; /* Compensate for border */
}
```

---

### Step 3: Update TrackList to Manage Selection

```typescript
export function TrackList() {
  const { selectedTrackId, toggleSelection } = useSelection();

  return (
    <div className="track-list-items">
      {tracks.map(track => (
        <TrackListItem
          key={track.id}
          track={track}
          isSelected={selectedTrackId === track.id}
          onSelect={() => toggleSelection(track.id)}
          onToggleVisibility={() => toggleVisibility.mutate(...)}
        />
      ))}
    </div>
  );
}
```

---

### Step 4: Pass Selection to Map for Highlighting

**Update `App.tsx`:**
```typescript
const { selectedTrackId, toggleSelection, clearSelection } = useSelection();

return (
  <div className="app-container">
    <div className="app-main">
      <Map geometries={visibleGeometries} selectedTrackId={selectedTrackId} />
    </div>
    <TrackList selectedTrackId={selectedTrackId} onSelect={toggleSelection} />
  </div>
);
```

---

### Step 5: Update Map to Highlight Selected Track

**Modify `Map.tsx` paint properties:**
```typescript
mapInstance.addLayer({
  id: 'track-lines',
  type: 'line',
  source: 'tracks',
  paint: {
    'line-color': [
      'case',
      ['==', ['get', 'id'], selectedTrackId || -1],
      '#FF66FF',  // Brighter magenta for selected
      config.trackColor  // Normal magenta
    ],
    'line-width': [
      'case',
      ['==', ['get', 'id'], selectedTrackId || -1],
      5,  // Thicker for selected
      3
    ],
    'line-opacity': 0.85
  }
})
```

---

## Testing

- [ ] Click track in sidebar → highlights in list
- [ ] Selected track appears brighter/thicker on map
- [ ] Click again → deselects
- [ ] Toggle visibility of selected track → stays selected
- [ ] Selection works with 50+ tracks

---

**Prompt Version**: 1.0
**Created**: After Feature 2 Phase 1 completion
